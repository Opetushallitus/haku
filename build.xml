<?xml version="1.0" encoding="UTF-8"?>
<project name="haku-deploy" basedir="." >

    <target name="deploy-to-remote-tomcat">

        <echo>Backup old haku.war</echo>
        <sshexec command="export DATE=`date +%F_%H-%M-%S`; mkdir $DATE ; cp -rf /data00/tomcat/apache-tomcat-7.0.29/webapps/haku.war $DATE"
                host="luokka" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                passphrase="" trust="true" failonerror="false" />

        <echo>Stop Tomcat</echo>
        <sshexec command="/etc/init.d/tomcat stop"
                 host="luokka" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                 passphrase="" trust="true" failonerror="false" />

        <echo>Clean Tomcat</echo>
        <sshexec command="rm -rf /data00/tomcat/apache-tomcat-7.0.29/webapps/haku* /data00/tomcat/apache-tomcat-7.0.29/work/* /data00/tomcat/apache-tomcat-7.0.29/temp/*"
                 host="luokka" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                 passphrase="" trust="true" failonerror="false" />

        <echo>Copy new haku.war</echo>
        <scp file="target/haku.war"
             todir="tomcat@luokka:/data00/tomcat/apache-tomcat-7.0.29/webapps/"
             keyfile="${user.home}/.ssh/id_rsa"
             />

        <echo>Start Tomcat</echo>
        <sshexec command="/etc/init.d/tomcat start"
                 host="luokka" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                 passphrase="" trust="true" failonerror="false" />

    </target>
</project>