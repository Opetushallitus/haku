<?xml version="1.0" encoding="UTF-8"?>
<project name="haku-deploy" basedir="." >

    <target name="deploy-to-remote-tomcat">
        <!--
        <echo>Backup old haku.war</echo>
        <sshexec command="export DATE=`date +%F_%H-%M-%S`; mkdir $DATE ; cp -rf /data00/tomcat/apache-tomcat-7.0.29/webapps/ROOT $DATE"
                host="${tomcat-host}" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                passphrase="" trust="true" failonerror="false" />
        -->
        <echo>Stop Tomcat</echo>
        <sshexec command="/etc/init.d/tomcat stop"
                 host="${tomcat-host}" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                 passphrase="" trust="true" failonerror="false" />

        <echo>Clean Tomcat</echo>
        <sshexec command="rm -rf /data00/tomcat/apache-tomcat-7.0.29/webapps/ROOT /data00/tomcat/apache-tomcat-7.0.29/work/* /data00/tomcat/apache-tomcat-7.0.29/temp/*"
                 host="${tomcat-host}" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                 passphrase="" trust="true" failonerror="false" />

        <echo>Copy new haku.war</echo>
        <scp file="target/haku.war"
             todir="tomcat@${tomcat-host}:/data00/tomcat/apache-tomcat-7.0.29/webapps/"
             keyfile="${user.home}/.ssh/id_rsa"
             />

        <echo>rename haku.war as ROOT</echo>
        <sshexec command="rm -rf /data00/tomcat/apache-tomcat-7.0.29/webapps/ROOT; mkdir /data00/tomcat/apache-tomcat-7.0.29/webapps/ROOT; unzip -qo -d/data00/tomcat/apache-tomcat-7.0.29/webapps/ROOT /data00/tomcat/apache-tomcat-7.0.29/webapps/haku.war; rm -rf /data00/tomcat/apache-tomcat-7.0.29/webapps/haku.war"
                 host="${tomcat-host}" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                 passphrase="" trust="true" failonerror="false" />

        <echo>Start Tomcat</echo>
        <sshexec command="/etc/init.d/tomcat start"
                 host="${tomcat-host}" username="tomcat" keyfile="${user.home}/.ssh/id_rsa"
                 passphrase="" trust="true" failonerror="false" />

        <echo>Successfully deployed haku.war to ${tomcat-host}</echo>
    </target>

</project>