<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>Mocha tests</title>
        <link rel="stylesheet" href="lib/mocha.css" media="all"/>
    </head>
    <body>
        <div id="mocha"></div>
        <script src="lib/mocha.js"></script>
        <script src="lib/chai.js"></script>
        <script src="lib/q.js"></script>
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        <script>
            var testTimeout = 30000;
            mocha.ui('bdd');
            mocha.reporter('html');
            mocha.timeout(testTimeout);
        </script>
        <script src="util/testHelpers.js"></script>
        <script src="page/lomakeSelectors.js"></script>
        <script src="page/virkailijaSelectors.js"></script>

        <!-- KK hakemus -->
        <script src="page/kkHakemusPage.js"></script>

        <script src="testspec/kkHakemusPageSpec.js"></script>

        <!-- 2. aste hakemus -->

        <script src="testspec/ToinenAsteOppijaHakemusSpec.js"></script>

        <script>
            $(document).ready(function() {
                if (window.mochaPhantomJS) {
                    mochaPhantomJS.run();
                } else {
                    runResults = {allDone: false, passed: 0, failed: 0, pending: 0, details: []};
                    runner = mocha.run().on('test end', function (test) {
                        if ('passed' === test.state) {
                            runResults.passed++;
                            runResults.details.push("Passed: "+test.title)
                        } else if (test.pending) {
                            runResults.pending++;
                            runResults.details.push("Pending: "+test.title)
                        } else {
                            runResults.failed++;
                            runResults.details.push("Failed: "+test.title + test.err)
                        }
                    }).on('suite end', function (suite) {
                        if (suite.root) {
                            runResults.allDone = true;
                            console.log(runResults);
                        }
                    });
                    $(document).keyup(function (e) {
                        if (e.keyCode == 27) {
                            runner._abort = true
                        }
                    });
                }
            })
        </script>
        <iframe id="testframe"></iframe>
    </body>
</html>
