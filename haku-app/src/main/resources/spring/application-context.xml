<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2012 The Finnish Board of Education - Opetushallitus
  ~
  ~ This program is free software:  Licensed under the EUPL, Version 1.1 or - as
  ~ soon as they will be approved by the European Commission - subsequent versions
  ~ of the EUPL (the "Licence");
  ~
  ~ You may not use this work except in compliance with the Licence.
  ~ You may obtain a copy of the Licence at: http://www.osor.eu/eupl/
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ European Union Public Licence for more details.
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:task="http://www.springframework.org/schema/task"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">


    <beans profile="default">
        <context:property-placeholder
                location="file:///${user.home:''}/oph-configuration/haku.properties,
                    file:///${user.home:''}/oph-configuration/common.properties,
                    file:///${user.home:''}/oph-configuration/override.properties"
                ignore-resource-not-found="true" properties-ref="defaultProps"/>

        <bean id="defaultProps" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
            <property name="properties">
                <util:properties local-override="true">
                    <prop key="cas_mode">front</prop>
                    <prop key="cas_key">haku</prop>
                    <prop key="cas_service">${cas.service.haku}</prop>
                    <prop key="spring_security_default_access">permitAll</prop>
                </util:properties>
            </property>
        </bean>
        <import resource="file:///${user.home:''}/oph-configuration/security-context-backend.xml"/>
        <import resource="authentication-service-context.xml"/>
        <import resource="classpath:/META-INF/spring/logger-context.xml"/>
    </beans>

    <beans profile="dev">
        <context:property-placeholder
                location="classpath:haku.properties, file:///${user.home:''}/oph-configuration/haku.properties,
                    file:///${user.home:''}/oph-configuration/common.properties, classpath:haku-test.properties"
                ignore-resource-not-found="true" properties-ref="defaultProps"/>
        <import resource="security-context-dev.xml"/>
        <bean id="defaultProps" class="org.springframework.beans.factory.config.PropertiesFactoryBean"/>
        <import resource="classpath:/META-INF/spring/logger-mock-context.xml"/>
    </beans>

    <beans>
        <context:annotation-config/>
        <context:component-scan
                base-package="fi.vm.sade.oppija,fi.vm.sade.security,fi.vm.sade.organisaatio.service.search"/>
        <aop:aspectj-autoproxy/>

        <!-- Configure the multipart resolver -->
        <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
            <!-- one of the properties available; the maximum file size in bytes -->
            <property name="maxUploadSize" value="1000000"/>
        </bean>

        <bean id="organisaatioSearchService" class="fi.vm.sade.organisaatio.service.search.OrganisaatioSearchService">
        </bean>
        <bean id="solrServerFactory" class="fi.vm.sade.organisaatio.service.search.SolrServerFactory">
        </bean>

        <bean id="yksilointiScheduler" class="fi.vm.sade.oppija.yksilointi.Scheduler">
            <property name="run" value="${scheduler.run}"/>
            <property name="sendMail" value="${scheduler.sendMail}"/>
            <property name="interval" value="${scheduler.delay}"/>
        </bean>
        <task:scheduled-tasks scheduler="scheduler">
            <task:scheduled ref="yksilointiScheduler" method="runIdentification" fixed-delay="${scheduler.delay}"/>
        </task:scheduled-tasks>

        <task:scheduler id="scheduler" pool-size="1"/>

        <import resource="cxf-context.xml"/>
    </beans>

</beans>
